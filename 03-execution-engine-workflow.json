{
  "name": "Quantitative Trading Engine - Execution Engine",
  "nodes": [
    {
      "name": "Trigger - Every 30 minutes",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [0, 0],
      "parameters": {
        "cronExpression": "*/30 * * * *",
        "timezone": "UTC"
      }
    },
    {
      "name": "Simulate Portfolio State",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [200, 0],
      "parameters": {
        "functionCode": "return [{json: {total_portfolio_value: 100000, positions: [{symbol: 'AAPL', quantity: 100, entry_price: 145}]}}];"
      }
    },
    {
      "name": "Simulate Signals",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [200, 100],
      "parameters": {
        "functionCode": "return [{json: {symbol: 'MSFT', signal: 1, signal_strength: 0.8, strategy_type: 'mean_reversion'}}];"
      }
    },
    {
      "name": "Simulate Current Prices",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [200, 200],
      "parameters": {
        "functionCode": "return [{json: {symbol: 'MSFT', close: 315}}];"
      }
    },
    {
      "name": "Execute Trades",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [400, 100],
      "parameters": {
        "functionCode": "const portfolio = items[0]?.json; const signals = items[1]?.json; const prices = items[2]?.json; const timestamp = new Date().toISOString(); const capital = (portfolio?.total_portfolio_value || 100000) * 0.01; const trades = []; if (signals && prices) {const position_size = capital / prices.close * (signals.signal_strength || 0.5); if (signals.signal === 1) {trades.push({symbol: signals.symbol, side: 'BUY', quantity: Math.floor(position_size), price: prices.close, strategy_type: signals.strategy_type, timestamp})} else if (signals.signal === -1) {trades.push({symbol: signals.symbol, side: 'SELL', quantity: Math.floor(position_size), price: prices.close, strategy_type: signals.strategy_type, timestamp})}}; return trades.map(t => ({json: t}));"
      }
    },
    {
      "name": "Format Trades for Output",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [600, 100],
      "parameters": {
        "mode": "manual",
        "assignments": {
          "assignments": [
            {
              "id": "0",
              "name": "trades_executed",
              "type": "expression",
              "value": "={{$json}}"
            }
          ]
        }
      }
    },
    {
      "name": "Log Trade Execution",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [800, 100],
      "parameters": {
        "functionCode": "const count = items.length; console.log(`[EXECUTION] Executed ${count} trades at ${new Date().toISOString()}`); return [{json: {status: 'success', trades_executed: count, timestamp: new Date().toISOString()}}];"
      }
    }
  ],
  "connections": {
    "Trigger - Every 30 minutes": {
      "main": [[{"node": "Simulate Portfolio State", "branch": 0, "index": 0}, {"node": "Simulate Signals", "branch": 0, "index": 0}, {"node": "Simulate Current Prices", "branch": 0, "index": 0}]]
    },
    "Simulate Portfolio State": {
      "main": [[{"node": "Execute Trades", "branch": 0, "index": 0}]]
    },
    "Simulate Signals": {
      "main": [[{"node": "Execute Trades", "branch": 0, "index": 1}]]
    },
    "Simulate Current Prices": {
      "main": [[{"node": "Execute Trades", "branch": 0, "index": 2}]]
    },
    "Execute Trades": {
      "main": [[{"node": "Format Trades for Output", "branch": 0, "index": 0}]]
    },
    "Format Trades for Output": {
      "main": [[{"node": "Log Trade Execution", "branch": 0, "index": 0}]]
    }
  },
  "settings": {
    "saveExecutionProgress": true
  },
  "active": false
}
